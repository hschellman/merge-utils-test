<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Design considerations &#8212; merge-utils 0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=0f882399" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
    <script src="_static/documentation_options.js?v=837179f8"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="canonical" href="https://hschellman.github.io/merge-utils-test/spec_v1.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">merge-utils 0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Design considerations</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="design-considerations">
<h1>Design considerations<a class="headerlink" href="#design-considerations" title="Link to this heading">¶</a></h1>
<p>H. Schellman and E. Muldoon
January 7 2025 - updated January 21, 2025, March 24, 2025</p>
<p>Description of issues for merging files</p>
<p>These are things we have learned from merging.  We have a prototype merging package which https://github.com/DUNE/data-management-ops/utilities/merging. It has 3 parts, a data file merger, a metadata merged, and a batch submission script. The plan is to create a new github repo for the next iteration of the merging code.</p>
<p>The central requirement is that merged data have merged metadata that allows one to understand/reproduce the inputs and the merge step itself.</p>
<p>This document describes</p>
<ol class="arabic" start="0">
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   motivation
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Input formats  
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Input delivery methods
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Merging methods  
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Requirements for merged metadata  
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Where this runs
</pre></div>
</div>
</li>
</ol>
</section>
<section id="motivation">
<h1>Motivation<a class="headerlink" href="#motivation" title="Link to this heading">¶</a></h1>
<p>Dune data operates on multiple scales, from 1 MB to 10 PB.  We need all of those data to be backed up to tape and catalogued which works optimally for files of size 1-10 GB.  This requires the ability to merge files and merge their metadata.  This document is about merging procedures for files below the size threshold for tape storage.</p>
</section>
<section id="inputs">
<h1>Inputs<a class="headerlink" href="#inputs" title="Link to this heading">¶</a></h1>
<p>We  know of 4 different input formats:</p>
<ol class="arabic">
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   HDF5 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Art-root
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Plain root
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Generic files (sam4users replacement)
</pre></div>
</div>
</li>
</ol>
<p>Each of these likely requires a different method to read them.  We have successfully merged art-root using art, plain root using hadd and generic files using tar.  HDF5 merge still needs to be developed.
Utilities needed: data merging
scripts that perform the merge of data and generate a checksum for the output.</p>
<ol class="arabic">
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Root  → hadd or custom
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Art-root → art
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Hdf5 → ??? 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Generic files → tar/gzip 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Utilities needed: List generation
</pre></div>
</div>
</li>
</ol>
<section id="at-the-list-generation-stage-we-need-methods-that">
<h2>At the list generation stage, we need methods that<a class="headerlink" href="#at-the-list-generation-stage-we-need-methods-that" title="Link to this heading">¶</a></h2>
<ul>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    Can take a metacat query or list of input files
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    check for duplicates in that list
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    validate the metadata for those input files is ok
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    Check that the metadata of the input files is consistent within requirements (see below)
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="move-from-jobsub-to-justin-for-batch-running">
<h1>Move from Jobsub to Justin for batch running<a class="headerlink" href="#move-from-jobsub-to-justin-for-batch-running" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p>the first iteration both ran interactively from a gpvm and via a jobsub script</p></li>
<li><p>The suggestion is that future runs be done via justin and/or interactively</p></li>
</ul>
<section id="justin-questions-2025-03-24">
<h2>Justin questions 2025-03-24<a class="headerlink" href="#justin-questions-2025-03-24" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>needs to be able to take a list of file locations (if the inputs are not declated to metacat yet) or</p></li>
<li><p>needs to be able to run over a dataset at a particular site that has the data available and enough capacity to run IO intensive activities</p></li>
<li><p>need to be able to specify an output RSE for merge jobs - how do we do this?</p></li>
</ul>
</section>
<section id="how-do-we-get-justin-to-run-over-chunks-of-files-in-a-list">
<h2>how do we get Justin to run over chunks of files in a list.<a class="headerlink" href="#how-do-we-get-justin-to-run-over-chunks-of-files-in-a-list" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>possibly - submit a job for each chunk.</p></li>
<li><p>possibly - submit N parallel jobs which are smart enough to use jobid to choose a chunk. What is jobid.</p></li>
</ul>
</section>
<section id="methods-needed">
<h2>Methods needed:<a class="headerlink" href="#methods-needed" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>justin jobscript that can take a list of files and loop over them</p></li>
<li><p>justin jobscript that can take a dataset and loop over them</p></li>
</ul>
</section>
</section>
<section id="delivery-methods">
<h1>Delivery methods<a class="headerlink" href="#delivery-methods" title="Link to this heading">¶</a></h1>
<ol class="arabic">
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   A rucio or metacat dataset with files declared to metacat
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   A disk directory with data files and their metadata which have not been declared
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   A disk directory with generic files that likely will need metadata creation.
</pre></div>
</div>
</li>
</ol>
<p>As merging is I/O intensive, the inputs need to be quite local to the process being run.  Right now we achieve this by either</p>
<p>a)         having rucio move the files to dcache at the merging site, or
b)         having the original batch job write back to the merging site, or
c)         using xroot to move files from remote RSE’s to a local cache area at the merging site</p>
<p>Currently done at FNAL (and FZU) this needs to be generalized to run at other sites.</p>
<p>We need methods:</p>
<ul>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Can take a list of did’s  and generate a list of valid locations given a merging site.
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Can check that those valid locations are not on tape and otherwise request that they be recovered from tape
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Can initiate a rucio move to the right location if needed. 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Can xrdcp to a local cache without using rucio if files are not cataloged yet. 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Need to be able to specify merging sites 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Need to be able to specify sites that are known to be unavailable. 
</pre></div>
</div>
</li>
</ul>
</section>
<section id="merging-methods">
<h1>Merging methods<a class="headerlink" href="#merging-methods" title="Link to this heading">¶</a></h1>
<p>The prototype system supports:</p>
<ol class="arabic">
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Merging small art files into larger ones without modification
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Merging small root files into larger ones without modification
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Creating a tar file from a list of files
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>   Creating CAF’s from a dataset or list of art files. 
</pre></div>
</div>
</li>
</ol>
<p><em>We still need an HDF5 merging script</em></p>
<p>The merges are done in “chunks” which are groups of files within a larger ordered list that produce an output file of appropriate size.  Jobs are submitted to batch as “chunks” while interactive processes can iterate over multiple chunks.  If anything fails for a chunk (data access, merge itself, metadata concatenation) the chunk is abandoned and will need to be redone.
Metadata requirements</p>
<p>The program <code class="docutils literal notranslate"><span class="pre">mergeMetaCat.py</span></code> takes a list of metadata files that were used to make a merged data file, checks for consistency and then merges the metadata.</p>
<p>The output merged metadata is placed in <code class="docutils literal notranslate"><span class="pre">&lt;merged</span> <span class="pre">data</span> <span class="pre">file&gt;.json</span></code> in the same directory.</p>
<section id="note-on-event-counting-and-tracking">
<h2>Note on Event counting and tracking<a class="headerlink" href="#note-on-event-counting-and-tracking" title="Link to this heading">¶</a></h2>
<p>Some processes drop events and do not fill the event list.</p>
<p>The event list is not useful for multi-run files because it doesn’t link event <code class="docutils literal notranslate"><span class="pre">#</span></code> and run <code class="docutils literal notranslate"><span class="pre">#</span></code>.  But it is useful for raw data - do we need to do something about this - like mod the event list for derived data to be run.event?
Do we want to read the root file to count the records in it so at least nevents is meaningful.</p>
<p>We need a method:<br />
·      root script that can count the events in an output file for inclusion in the metadata.</p>
</section>
</section>
<section id="consistency-checks">
<h1>Consistency checks<a class="headerlink" href="#consistency-checks" title="Link to this heading">¶</a></h1>
<p>Before a merge is done, one needs to check that the data being merged is consistent. This is currently done after the data merge as a final check but should probably be done before data are merged.</p>
<p><code class="docutils literal notranslate"><span class="pre">[&quot;</span> <span class="pre">“core.run_type&quot;,</span> <span class="pre">“core.file_type&quot;,</span> <span class="pre">&quot;namespace&quot;,</span> <span class="pre">&quot;core.file_format&quot;,</span> <span class="pre">&quot;core.data_tier&quot;,</span> <span class="pre">&quot;core.data_stream&quot;,</span> <span class="pre">'core.application.name',</span> <span class="pre">'dune.campaign',</span> <span class="pre">'DUNE.requestid',</span> <span class="pre">'dune.requestid']</span></code></p>
<p>Currently we do not require that <code class="docutils literal notranslate"><span class="pre">dune.config_file</span></code> or <code class="docutils literal notranslate"><span class="pre">core.application.version</span></code> be exactly consistent to allow patches, likely strict consistency for these fiels should be an option.</p>
<p>Methods needed:<br />
·      script that can take a list of files or metadata files and check for consistency.  This exists as part of mergeMetaCar.py but should be pulled out for use before merging starts.</p>
</section>
<section id="metadata-merge">
<h1>Metadata merge:<a class="headerlink" href="#metadata-merge" title="Link to this heading">¶</a></h1>
<p>What gets combined:</p>
<p>The  metadata merging program takes a list of input metadata and data files.</p>
<ul>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Merges the runs and subruns lists
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Calculates the number of events in the file (see above for alternative)
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Calculates the first/last event range – should it merge the actual event lists for single run files?
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Creates parentage from the input files.  If the inputs have not been declared yet, their parents are the parents for the merge file. 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Calculates a checksum and adds it and the merged data filesize to the metadata.
</pre></div>
</div>
</li>
</ul>
<section id="metadata-fields-added">
<h2>Metadata fields added:<a class="headerlink" href="#metadata-fields-added" title="Link to this heading">¶</a></h2>
<p>The output file <code class="docutils literal notranslate"><span class="pre">name</span></code> needs to be generated either at the data merging or metadata merging phase. This is currently generated from the generic fields from the metadata of the first file in the list during the initial data merge and passed into the merger.</p>
<ul>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    `dune.dataset_name` is an output dataset name that needs to be generated to give rucio/metacat a place to put the * ou tput files. This is currently generated from the merged metadata if not supplied on the command line
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  `dune.output_status` is set to “merged” - should be updated to “confirmed” once actually stored by declaD
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  `dune.merging_stage` is set to “final” if done, otherwise some intermediate status.  If not “final”, another merging stage will be run. 
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  `dune.merging_range` has the ranges for the files merged in the input list. 
</pre></div>
</div>
</li>
</ul>
<p>Methods needed:</p>
<ul>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Output filename generator
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Output dataset name generator
</pre></div>
</div>
</li>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  Metadata checking
</pre></div>
</div>
</li>
</ul>
<p>The output metadata is then checked with <code class="docutils literal notranslate"><span class="pre">TypeChecker.py</span></code> – it currently flags but does not patch incorrect or missing input metadata</p>
</section>
<section id="enhancements-to-typechecker-py">
<h2>enhancements to <code class="docutils literal notranslate"><span class="pre">TypeChecker.py</span></code><a class="headerlink" href="#enhancements-to-typechecker-py" title="Link to this heading">¶</a></h2>
<p>Possibly add a database of valid values for core metadata (data_tier, run_type …) and refuse to pass data that uses novel values until cleared by an admin) and abbreviations for important values to make auto-generated dataset and filenames shorter.</p>
<p>Example: full-reconstructed → FReco, vd-protodune → PDVD … store them in the valid fields config file.</p>
</section>
<section id="sam4users">
<h2>Sam4users<a class="headerlink" href="#sam4users" title="Link to this heading">¶</a></h2>
<p>If we use this system to replace <code class="docutils literal notranslate"><span class="pre">sam4users</span></code>, what metadata should be stored for the tar file generated? Should it contain a directory listing for the tar file so that it is searchable? What files should be included? Which not?</p>
</section>
</section>
<section id="where-this-runs">
<h1>Where this runs<a class="headerlink" href="#where-this-runs" title="Link to this heading">¶</a></h1>
<p>The current setup is designed to run on Fermilab systems in either batch or interactive mode.   Rucio inputs work in batch, otherwise one needs to run interactively.</p>
<p>Iterative merging needs to be done interactively as the intermediate files are not declared to metacat.</p>
<p>Methods needed:<br />
·      Neet do be able to specify merging sites more broadly.</p>
</section>
<section id="suggestions-for-future-versions">
<h1>Suggestions for future versions<a class="headerlink" href="#suggestions-for-future-versions" title="Link to this heading">¶</a></h1>
<p>Consistency and quality checks for metadata likely should be moved earlier in the sequence. In principle these can be done before the task is even submitted to batch.</p>
<p>The current version throws an error and refuses to merge if any file is not available in an input chunk (normally 1-4 GB of data).  Do we want to add the option of culling bad files from a chunk before sending it to the merge process?</p>
<p>We don’t have a final check yet that can pick up files missed on the first round, except by checking by hand and resubmitting merges chunk by chunk.</p>
<p>All of the scripts take similar arguments and pass them to each other.  Making a single arguments system would make the code a lot easier to maintain.</p>
<p>Method needs:</p>
<ul>
<li><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    Need a method that can check a list of input files to check which have been merged and which have not.  Can use metadata - for example `dune.output_status=merged` if the parent files have been merged. 
</pre></div>
</div>
</li>
</ul>
</section>
<section id="design-ideas">
<h1>Design ideas:<a class="headerlink" href="#design-ideas" title="Link to this heading">¶</a></h1>
<p>How do we specify parameters for a merge?</p>
<p>·      Command line
·      YAML/json</p>
<p>What parameters have we used?  * indicates things that are used to make a query.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                        <span class="n">fcl</span> <span class="n">file</span> <span class="n">to</span> <span class="n">use</span> <span class="k">with</span> <span class="n">lar</span> <span class="n">when</span> <span class="n">making</span> <span class="n">tuples</span><span class="p">,</span> <span class="n">required</span> <span class="k">with</span> <span class="o">--</span><span class="n">uselar</span>
                        
 <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>            <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
 
  <span class="o">--</span><span class="n">detector</span> <span class="n">DETECTOR</span>   <span class="n">detector</span> <span class="nb">id</span> <span class="p">[</span><span class="n">hd</span><span class="o">-</span><span class="n">protodune</span><span class="p">]</span>
  
  <span class="o">--</span><span class="n">input_dataset</span> <span class="n">INPUT_DATASET</span>
                        <span class="n">metacat</span> <span class="n">dataset</span> <span class="k">as</span> <span class="nb">input</span>
                        
  <span class="o">--</span><span class="n">chunk</span> <span class="n">CHUNK</span>         <span class="n">number</span> <span class="n">of</span> <span class="n">files</span><span class="o">/</span><span class="n">merge</span> <span class="n">this</span> <span class="n">step</span><span class="p">,</span> <span class="n">should</span> <span class="n">be</span> <span class="o">&lt;</span> <span class="mi">100</span>
  
  <span class="o">--</span><span class="n">nfiles</span> <span class="n">NFILES</span>       <span class="n">number</span> <span class="n">of</span> <span class="n">files</span> <span class="n">to</span> <span class="n">merge</span> <span class="n">total</span>
  
  <span class="o">--</span><span class="n">skip</span> <span class="n">SKIP</span>           <span class="n">number</span> <span class="n">of</span> <span class="n">files</span> <span class="n">to</span> <span class="n">skip</span> <span class="n">before</span> <span class="n">doing</span> <span class="n">nfiles</span>
  
  <span class="o">--</span><span class="n">run</span> <span class="n">RUN</span>             <span class="n">run</span> <span class="n">number</span>
  
  <span class="o">--</span><span class="n">destination</span> <span class="n">DESTINATION</span>
                        <span class="n">destination</span> <span class="n">directory</span>
                        
  <span class="o">--</span><span class="n">input_data_tier</span> <span class="n">INPUT_DATA_TIER</span>
                        <span class="nb">input</span> <span class="n">data</span> <span class="n">tier</span> <span class="p">[</span><span class="n">root</span><span class="o">-</span><span class="nb">tuple</span><span class="o">-</span><span class="n">virtual</span><span class="p">]</span>
                        
  <span class="o">--</span><span class="n">output_data_tier</span> <span class="n">OUTPUT_DATA_TIER</span>
                        <span class="n">output</span> <span class="n">data</span> <span class="n">tier</span>
                        
  <span class="o">--</span><span class="n">output_file_format</span> <span class="n">OUTPUT_FILE_FORMAT</span>
                        <span class="n">output</span> <span class="n">file_format</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
                        
  <span class="o">--</span><span class="n">output_namespace</span> <span class="n">OUTPUT_NAMESPACE</span>
                        <span class="n">output</span> <span class="n">namespace</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
                        
  <span class="o">--</span><span class="n">file_type</span> <span class="n">FILE_TYPE</span>
                        <span class="nb">input</span> <span class="n">detector</span> <span class="ow">or</span> <span class="n">mc</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">detector</span>
                        
  <span class="o">--</span><span class="n">application</span> <span class="n">APPLICATION</span>
                        <span class="n">merge</span> <span class="n">application</span> <span class="n">name</span> <span class="p">[</span><span class="n">inherits</span><span class="p">]</span>
                        
  <span class="o">--</span><span class="n">input_version</span> <span class="n">INPUT_VERSION</span>
                        <span class="n">software</span> <span class="n">version</span> <span class="n">of</span> <span class="n">files</span> <span class="n">to</span> <span class="n">merge</span> <span class="p">(</span><span class="n">required</span><span class="p">)</span>
                        
  <span class="o">--</span><span class="n">merge_version</span> <span class="n">MERGE_VERSION</span>
                        <span class="n">software</span> <span class="n">version</span> <span class="k">for</span> <span class="n">merged</span> <span class="n">file</span> <span class="p">[</span><span class="n">inherits</span><span class="p">]</span>
                        
  <span class="o">--</span><span class="n">debug</span>               <span class="n">make</span> <span class="n">very</span> <span class="n">verbose</span>
  
  <span class="o">--</span><span class="n">maketarball</span>         <span class="n">make</span> <span class="n">a</span> <span class="n">tarball</span> <span class="n">of</span> <span class="n">source</span>
  
  <span class="o">--</span><span class="n">usetarball</span> <span class="n">USETARBALL</span>
                        <span class="n">full</span> <span class="n">path</span> <span class="k">for</span> <span class="n">existing</span> <span class="n">tarball</span>
                        
  <span class="o">--</span><span class="n">uselar</span>              <span class="n">use</span> <span class="n">lar</span> <span class="n">instead</span> <span class="n">of</span> <span class="n">hadd</span> <span class="ow">or</span> <span class="n">tar</span>
  
  <span class="o">--</span><span class="n">lar_config</span> <span class="n">LAR_CONFIG</span>
                        <span class="n">fcl</span> <span class="n">file</span> <span class="n">to</span> <span class="n">use</span> <span class="k">with</span> <span class="n">lar</span> <span class="n">when</span> <span class="n">making</span> <span class="n">tuples</span><span class="p">,</span> <span class="n">required</span> <span class="k">with</span> <span class="o">--</span><span class="n">uselar</span>
                        
  <span class="o">--</span><span class="n">merge_stage</span> <span class="n">MERGE_STAGE</span>
                        <span class="n">stage</span> <span class="n">of</span> <span class="n">merging</span><span class="p">,</span> <span class="n">final</span> <span class="k">for</span> <span class="n">last</span> <span class="n">step</span>
                        
  <span class="o">--</span><span class="n">project_tag</span> <span class="n">PROJECT_TAG</span>
                        <span class="n">tag</span> <span class="n">to</span> <span class="n">describe</span> <span class="n">the</span> <span class="n">project</span> <span class="n">you</span> <span class="n">are</span> <span class="n">doing</span>
                        
  <span class="o">--</span><span class="n">direct_parentage</span>    <span class="n">parents</span> <span class="n">are</span> <span class="n">the</span> <span class="n">files</span> <span class="n">you</span> <span class="n">are</span> <span class="n">merging</span><span class="p">,</span> <span class="ow">not</span> <span class="n">their</span> <span class="n">parents</span>
  
  <span class="o">--</span><span class="n">inherit_config</span>      <span class="n">inherit</span> <span class="n">config</span> <span class="n">file</span> <span class="o">-</span> <span class="n">use</span> <span class="k">for</span> <span class="n">hadd</span> <span class="n">stype</span> <span class="n">merges</span>
  
  <span class="o">--</span><span class="n">output_datasetName</span> <span class="n">OUTPUT_DATASETNAME</span>
                        <span class="n">optional</span> <span class="n">name</span> <span class="n">of</span> <span class="n">output</span> <span class="n">dataset</span> <span class="n">this</span> <span class="n">will</span> <span class="n">go</span> <span class="n">into</span>
                        
  <span class="o">--</span><span class="n">campaign</span> <span class="n">CAMPAIGN</span>   <span class="n">campaign</span> <span class="k">for</span> <span class="n">the</span> <span class="n">merge</span><span class="p">,</span> <span class="n">default</span> <span class="ow">is</span> <span class="n">campaign</span> <span class="n">of</span> <span class="n">the</span> <span class="n">parents</span>

 <span class="o">--</span><span class="n">merge_stage</span> <span class="n">MERGE_STAGE</span>
                        <span class="n">stage</span> <span class="n">of</span> <span class="n">merging</span><span class="p">,</span> <span class="n">final</span> <span class="k">for</span> <span class="n">last</span> <span class="n">step</span>
</pre></div>
</div>
<p>Things to add</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>–query METACAT query , overides many of the input metadata fields. 

–output_file_size_goal  - specify this to calculate chunk. 
–find_nevents - read the file to find the nevents
</pre></div>
</div>
<p>When making file/dataset names - abbreviations for common fields. (example full-reconstructed→ freco)</p>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Design considerations</a></li>
<li><a class="reference internal" href="#motivation">Motivation</a></li>
<li><a class="reference internal" href="#inputs">Inputs</a><ul>
<li><a class="reference internal" href="#at-the-list-generation-stage-we-need-methods-that">At the list generation stage, we need methods that</a></li>
</ul>
</li>
<li><a class="reference internal" href="#move-from-jobsub-to-justin-for-batch-running">Move from Jobsub to Justin for batch running</a><ul>
<li><a class="reference internal" href="#justin-questions-2025-03-24">Justin questions 2025-03-24</a></li>
<li><a class="reference internal" href="#how-do-we-get-justin-to-run-over-chunks-of-files-in-a-list">how do we get Justin to run over chunks of files in a list.</a></li>
<li><a class="reference internal" href="#methods-needed">Methods needed:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#delivery-methods">Delivery methods</a></li>
<li><a class="reference internal" href="#merging-methods">Merging methods</a><ul>
<li><a class="reference internal" href="#note-on-event-counting-and-tracking">Note on Event counting and tracking</a></li>
</ul>
</li>
<li><a class="reference internal" href="#consistency-checks">Consistency checks</a></li>
<li><a class="reference internal" href="#metadata-merge">Metadata merge:</a><ul>
<li><a class="reference internal" href="#metadata-fields-added">Metadata fields added:</a></li>
<li><a class="reference internal" href="#enhancements-to-typechecker-py">enhancements to <code class="docutils literal notranslate"><span class="pre">TypeChecker.py</span></code></a></li>
<li><a class="reference internal" href="#sam4users">Sam4users</a></li>
</ul>
</li>
<li><a class="reference internal" href="#where-this-runs">Where this runs</a></li>
<li><a class="reference internal" href="#suggestions-for-future-versions">Suggestions for future versions</a></li>
<li><a class="reference internal" href="#design-ideas">Design ideas:</a></li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/spec_v1.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">merge-utils 0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Design considerations</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2025, Fermi National Accelerator Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>